using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Xml.Linq;
using Lime49;

namespace CsvGrabber.Core
{
    public class Utils
    {
        /// <summary>
        /// Serializes a collection of URLs.
        /// </summary>
        /// <param name="urls">The URLs.</param>
        /// <returns>An XDocument containing the URLs.</returns>
        public static string SerializeUrls(IEnumerable<GrabbableUrl> urls) {
            XDocument doc = new XDocument();
            XElement eleUrls = new XElement("urls");
            doc.Add(eleUrls);
            foreach (GrabbableUrl url in urls) {
                eleUrls.Add(url.ToXElement());
            }
            return doc.ToString();
        }

        /// <summary>
        /// Deserializes a list of URLs.
        /// </summary>
        /// <param name="serializedSavedUrls">The serialized list of URLs.</param>
        /// <returns>The GrabbableUrls parsed from the list</returns>
        public static IEnumerable<GrabbableUrl> DeserializeUrls(string serializedSavedUrls)
        {
            XDocument doc = XDocument.Parse(serializedSavedUrls);
            XElement root = doc.Element("urls");
            var urlElements = root.Elements("grabbableurl");
            var urls = urlElements.Select(e => new GrabbableUrl(e));
            return urls;
        }

        public static string SerializeList(IEnumerable<string> items)
        {
            XDocument doc = new XDocument();
            XElement eleItems = new XElement("items");
            doc.Add(eleItems);
            foreach (string itm in items) {
                eleItems.Add(new XElement("item", HtmlUtils.HtmlEncode(itm)));
            }
            return doc.ToString();
        }

        public static List<string> DeserializeList(string serializedItems)
        {
            XDocument doc = XDocument.Parse(serializedItems);
            XElement root = doc.Element("items");
            var elements = root.Elements("item");
            var urls = elements.Select(e => HtmlUtils.HtmlDecode(e.Value));
            return urls.ToList();
        }
    }
}