using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Text.RegularExpressions;
using System.Xml.Linq;
using Lime49;

namespace CsvGrabber.Core
{
    public class GrabEventArgs : EventArgs
    {
        public GrabbableUrl Url { get; set; }
        public Regex GrabExpression { get; set; }

        public GrabEventArgs() {
            Url = new GrabbableUrl(string.Empty);
        }

        public GrabEventArgs(GrabbableUrl urlToGrab)
            : this(){
            Url =urlToGrab;
        }

        public GrabEventArgs(GrabbableUrl urlToGrab, string grabExpression)
            : this(urlToGrab)
        {
            this.GrabExpression = new Regex (grabExpression);
        }

        public string Serialize()
        {
            XElement ele = new XElement("grabeventargs",
                new XElement("grabexpression", this.GrabExpression),
                new XElement("url", this.Url));
            return ele.ToString();
        }

        public static GrabEventArgs Deserialize(string serialized) {
            XElement ele = XElement.Parse(serialized);
            GrabEventArgs args = new GrabEventArgs()
            {
                GrabExpression = new Regex (HtmlUtils.HtmlDecode(ele.Element("grabexpression").Value)),
                Url = new GrabbableUrl(ele.Element("url")),
            };
            return args;
        }
    }
}
